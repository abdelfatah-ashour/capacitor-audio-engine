<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title>Multi-Audio Resume Demo</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- Global Controls -->
  <ion-card class="global-controls">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="musical-notes-outline"></ion-icon>
        Global Settings
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-item>
        <ion-label>Global Speed: {{ globalSpeed().toFixed(1) }}x</ion-label>
        <ion-range
          min="0.5"
          max="2.0"
          step="0.1"
          [value]="globalSpeed()"
          (ionChange)="onGlobalSpeedChange($event)"
          color="primary">
          <ion-icon name="speedometer-outline" slot="start"></ion-icon>
        </ion-range>
      </ion-item>

      <ion-item>
        <ion-label>Global Volume: {{ (globalVolume() * 100).toFixed(0) }}%</ion-label>
        <ion-range
          min="0"
          max="1"
          step="0.1"
          [value]="globalVolume()"
          (ionChange)="onGlobalVolumeChange($event)"
          color="primary">
          <ion-icon name="volume-high-outline" slot="start"></ion-icon>
        </ion-range>
      </ion-item>

      <ion-button expand="block" (click)="applyGlobalSettings()" color="tertiary">
        Apply to All Audio Records
      </ion-button>
    </ion-card-content>
  </ion-card>

  <!-- Loading State -->
  @if (isLoading()) {
    <ion-card>
      <ion-card-content class="ion-text-center">
        <ion-spinner></ion-spinner>
        <p>Preloading audio files...</p>
      </ion-card-content>
    </ion-card>
  }

  <!-- Resume Demo Section -->
  <ion-card class="resume-demo">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="play-circle-outline"></ion-icon>
        Resume Functionality Demo
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>Test the new resume functionality with these controls:</p>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <ion-button
          expand="block"
          fill="outline"
          (click)="quickDemo()"
          color="primary">
          <ion-icon name="flash-outline" slot="start"></ion-icon>
          Quick Demo: Play → Pause → Resume
        </ion-button>

        <ion-button
          expand="block"
          fill="outline"
          (click)="crossAudioDemo()"
          color="secondary">
          <ion-icon name="swap-horizontal-outline" slot="start"></ion-icon>
          Cross-Audio Demo: Multiple Paused States
        </ion-button>
      </div>

      <!-- Resume Status Display -->
      @if (pausedAudioStates().length > 0) {
        <div class="paused-states">
          <h4>Currently Paused Audio (with positions):</h4>
          <ion-list>
            @for (state of pausedAudioStates(); track state.id) {
              <ion-item>
                <ion-icon name="pause-circle-outline" slot="start" color="warning"></ion-icon>
                <ion-label>
                  <h3>{{ state.name }}</h3>
                  <p>Paused at: {{ formatTime(state.pausedAt) }} / {{ formatTime(state.duration) }}</p>
                </ion-label>
                <ion-button
                  slot="end"
                  fill="clear"
                  (click)="resumeSpecificAudio(state.id)"
                  color="success">
                  <ion-icon name="play-outline"></ion-icon>
                  Resume Here
                </ion-button>
              </ion-item>
            }
          </ion-list>
        </div>
      }
    </ion-card-content>
  </ion-card>

  <!-- Audio Records List -->
  <ion-card class="audio-records">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="cloud-outline"></ion-icon>
        Audio Records ({{ audioRecords().length }}/10)
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list>
        @for (record of audioRecords(); track record.id) {
          <ion-item class="audio-record-item">
            <div class="record-content">
              <!-- Record Header -->
              <div class="record-header">
                <h3>{{ record.name }}</h3>
                <div class="record-badges">
                  @if (record.isPreloaded) {
                    <ion-badge color="success">
                      <ion-icon name="checkmark-circle-outline"></ion-icon>
                      Preloaded
                    </ion-badge>
                  }
                  @if (record.isPlaying) {
                    <ion-badge color="primary">
                      <ion-icon name="play-circle-outline"></ion-icon>
                      Playing
                    </ion-badge>
                  }
                  @if (record.isPaused) {
                    <ion-badge color="warning">
                      <ion-icon name="pause-outline"></ion-icon>
                      Paused
                    </ion-badge>
                  }
                </div>
              </div>

              <!-- Playback Controls -->
              <div class="playback-controls">
                @if (!record.isPlaying && !record.isPaused) {
                  <ion-button (click)="playAudioRecord(record.id)" color="primary" size="small">
                    <ion-icon name="play-outline"></ion-icon>
                    Play
                  </ion-button>
                }
                @if (record.isPlaying) {
                  <ion-button (click)="pauseAudioRecord(record.id)" color="warning" size="small">
                    <ion-icon name="pause-outline"></ion-icon>
                    Pause
                  </ion-button>
                }
                @if (record.isPaused) {
                  <ion-button (click)="resumeAudioRecord(record.id)" color="success" size="small">
                    <ion-icon name="play-outline"></ion-icon>
                    Resume
                  </ion-button>
                }
                @if (record.isPlaying || record.isPaused) {
                  <ion-button (click)="stopAudioRecord(record.id)" color="danger" size="small" fill="outline">
                    <ion-icon name="stop-outline"></ion-icon>
                    Stop
                  </ion-button>
                }
              </div>

              <!-- Progress Bar -->
              <div class="progress-section">
                <div class="time-info">
                  <span class="current-time">{{ formatTime(record.currentTime) }}</span>
                  <span class="duration">{{ formatTime(record.duration) }}</span>
                </div>
                <div class="progress-bar">
                  <div
                    class="progress-fill"
                    [style.width.%]="getProgressPercentage(record)">
                  </div>
                </div>
              </div>

              <!-- Individual Audio Settings -->
              <div class="audio-settings">
                <ion-item>
                  <ion-label>Speed: {{ record.speed.toFixed(1) }}x</ion-label>
                  <ion-range
                    min="0.5"
                    max="2.0"
                    step="0.1"
                    [value]="record.speed"
                    (ionChange)="onSpeedChange(record.id, $event)"
                    color="primary">
                  </ion-range>
                </ion-item>

                <ion-item>
                  <ion-label>Volume: {{ (record.volume * 100).toFixed(0) }}%</ion-label>
                  <ion-range
                    min="0"
                    max="1"
                    step="0.1"
                    [value]="record.volume"
                    (ionChange)="onVolumeChange(record.id, $event)"
                    color="primary">
                  </ion-range>
                </ion-item>

                <ion-item>
                  <ion-label>Loop</ion-label>
                  <ion-toggle
                    [checked]="record.loop"
                    (ionChange)="toggleAudioLoop(record.id)"
                    slot="end">
                  </ion-toggle>
                </ion-item>
              </div>
            </div>
          </ion-item>
        }
      </ion-list>
    </ion-card-content>
  </ion-card>

  <!-- Instructions -->
  <ion-card class="instructions">
    <ion-card-header>
      <ion-card-title>
        <ion-icon name="information-circle-outline"></ion-icon>
        Resume Playback Features
      </ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p><strong>New Resume Functionality:</strong></p>
      <ul>
        <li><strong>Smart Resume:</strong> Each audio remembers its paused position</li>
        <li><strong>URI-Specific Resume:</strong> Resume any previously paused audio by clicking its Resume button</li>
        <li><strong>Cross-Audio Resume:</strong> You can resume a different audio than the currently active one</li>
        <li><strong>Position Memory:</strong> Audio resumes from the exact position where it was paused, not from the beginning</li>
        <li><strong>Settings Preservation:</strong> Resume with the same or different speed/volume/loop settings</li>
      </ul>
      <p><strong>Try This:</strong></p>
      <ol>
        <li>Play Audio 1, let it play for 10 seconds, then pause it</li>
        <li>Play Audio 2, let it play for 5 seconds, then pause it</li>
        <li>Click "Resume" on Audio 1 - it should resume from 10 seconds, not from the beginning</li>
        <li>Click "Resume" on Audio 2 - it should resume from 5 seconds</li>
        <li>Change speed/volume settings and resume - it will apply the new settings while maintaining position</li>
      </ol>
    </ion-card-content>
  </ion-card>

  <!-- Refresh Button -->
  <ion-fab vertical="bottom" horizontal="end">
    <ion-fab-button (click)="preloadAllAudio()" color="primary">
      <ion-icon name="refresh-outline"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
