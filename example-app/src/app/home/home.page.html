<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Audio Recorder
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar>
      <ion-title size="large">Audio Recorder</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="ion-padding">
    @if(hasPermission){
      <ion-text color="success">
        <p class="permission-status">Audio recording permission granted</p>
      </ion-text>
    }@else{
      <ion-text color="danger">
        <p class="permission-status">Audio recording not granted</p>
      </ion-text>
    }

    @if(!hasPermission){
      <ion-button expand="block" class="permission-button" (click)="checkPermission()">
        <ion-icon name="mic-outline" slot="start"></ion-icon>
        Request Permission
      </ion-button>
    }@else {
      <!-- Recording Controls -->
      <div class="recording-controls ion-margin-top">
        @if(!isRecording) {
          <ion-button expand="block" color="primary" (click)="startRecording()">
            <ion-icon name="mic-outline" slot="start"></ion-icon>
            Start Recording
          </ion-button>
        } @else {
          <ion-button expand="block" color="danger" (click)="stopRecording()">
            <ion-icon name="stop-outline" slot="start"></ion-icon>
            Stop Recording
          </ion-button>
        }
      </div>
    }
    @if(recordingUrl()){
      <audio [src]="recordingUrl()" controls>
        Your browser does not support the audio element.
      </audio>

      <div class="time-display">
        <span>{{ formatTime(currentAudioTime()) }}</span>
        <span> / </span>
        <span>{{ formatTime(endAudioTime()) }}</span>
      </div>

      <ion-range
        [dualKnobs]="true"
        [min]="0"
        [max]="duration"
        [value]="[startAudioTime(), endAudioTime()]"
        (ionChange)="handleRangeChange($event)"
        class="audio-range">
      </ion-range>
      <div>
        <ion-button>
          <ion-icon name="play-outline"></ion-icon>
          <ion-text>
            start: {{ formatTime(startAudioTime()) }}
          </ion-text>
          <ion-text>
            end: {{ formatTime(endAudioTime()) }}
          </ion-text>
        </ion-button>
      </div>
      <ion-button expand="block" color="primary" (click)="trimAudio()">
        Trim Audio
      </ion-button>
    }
      <ion-text color="primary">
        {{ recordingUrl() }}
      </ion-text>
    <ion-button (click)="testInterruptionListener()">
      Test Interruption Listener
    </ion-button>
  </div>
</ion-content>
